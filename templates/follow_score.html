{% extends "follow_base.html" %}
{% block content %}
    {{ super() }}
    <style>
        .chart {
            width: 100%;
            height: 500px;
        }
    </style>

    <div id="line-chart" class="chart"></div>
    <br>
    <div id="predict-chart" class="chart"></div>

    <script>
        var line_chart=echarts.init(document.getElementById('line-chart')),
            predict_chart=echarts.init(document.getElementById('predict-chart')),
            USERNAME=decodeURIComponent("{{ g.fname | urlencode }}");
        line_chart.showLoading();
        predict_chart.showLoading();

        $.when(
            $.get('{{ url_for('api_predict',eventid=g.eventid) }}'),
            $.get('{{ url_for('api_follower_score',eventid=g.eventid,ind=g.follower_ind) }}')
        ).done(function(data,_todo) {
            line_chart.hideLoading();
            line_chart.setOption({
                title: {
                    text: '实际分数'
                },
                tooltip: {},
                legend: {
                    data : ['一档·实际','二档·实际','三档·实际','一档·拟合','二档·拟合','三档·拟合',USERNAME]
                },
                xAxis: {
                    type: 'category',
                    data: data['times']
                },
                yAxis: {},
                dataZoom: [{
                    type: 'slider',
                    start: 0,
                    end: 100
                }],
                series: [
                    {name: '一档·实际', type: 'line', lineStyle:{normal: {type: 'solid'}}, data: data['l1c']},
                    {name: '二档·实际', type: 'line', lineStyle:{normal: {type: 'solid'}}, data: data['l2c']},
                    {name: '三档·实际', type: 'line', lineStyle:{normal: {type: 'solid'}}, data: data['l3c']},
                    {name: '一档·拟合', type: 'line', lineStyle:{normal: {type: 'dotted'}}, data: data['l1r']},
                    {name: '二档·拟合', type: 'line', lineStyle:{normal: {type: 'dotted'}}, data: data['l2r']},
                    {name: '三档·拟合', type: 'line', lineStyle:{normal: {type: 'dotted'}}, data: data['l3r']}
                ]
            });
            predict_chart.hideLoading();
            predict_chart.setOption({
                title: {
                    text: '预测分数'
                },
                tooltip: {},
                legend: {
                    data : ['一档','二档','三档']
                },
                xAxis: {
                    type: 'category',
                    data: data['times']
                },
                yAxis: {},
                dataZoom: [{
                    type: 'slider',
                    start: 0,
                    end: 100
                }],
                series: [
                    {name: '一档', type: 'line', lineStyle:{normal: {type: 'solid'}}, data: data['l1p']},
                    {name: '二档', type: 'line', lineStyle:{normal: {type: 'solid'}}, data: data['l2p']},
                    {name: '三档', type: 'line', lineStyle:{normal: {type: 'solid'}}, data: data['l3p']}
                ]
            });
        });
    </script>
{% endblock %}